let game={maxXY:500,canDraw:!1,valid:!1,lineWidth:5,oob:[0,1,2,3,6,7,8,9,10,11,18,19,20,29,30,39,60,69,70,79,80,81,88,89,90,91,92,93,96,97,98,99],offset:{"03":[20,0],"06":[20,0],30:[0,20],60:[0,20],"04":[15,0],"05":[15,0],40:[15,0],50:[15,0],93:[-20,0],96:[-20,0],39:[0,-20],69:[0,-20],49:[0,-15],59:[0,-15],94:[-15,0],95:[-15,0]},colors:["ff0000","00ff00","0000ff","ffff00"],levels:[[["2187","7166","2382"],["2187","0566","0328"],["1259","5278","6057"],["2460","0657","1274"],["1269","2687","2157"],["4036","3378","1274"],["2193","2460","4057"],["2124","2872","0547"]],[["0454","4078","2135","2876"],["2125","0647","2873","6075"],["2146","1764","2594","3378"],["1244","2833","4294","4660"],["3073","0565","3693","3459"],["0334","2659","4296","6671"],["2176","0432","4694","2359"],["1734","1369","5295","6671"]],[["3056","0537","3593","2852"],["0575","4249","2595","4047"],["4387","1256","3693","1763"],["0474","1776","5471","8226"]]],paths:[],levelCompleted:[],currentLevel:"00",currentTarget:"null"};!function(l){let n=l("#game_menu"),g=l("#game_wrapper"),e=l("#game"),r=l("#pad"),o=l("#settings"),t=e[0].getContext("2d"),s=r[0].getContext("2d"),m=l("#check")[0].getContext("2d"),h=0,v=0,p=[];const f=()=>{var e=JSON.parse(localStorage.getItem("twodots"));e&&(game.levelCompleted=e.levelCompleted||[])},u=()=>{game.paths=[],t.clearRect(0,0,r[0].width,r[0].height),s.strokeStyle=t.strokeStyle="#000",x(),g.find(".node").remove(),[a,b]=game.currentLevel.split("");let e=game.levels[a][b];for(i in e)[a,b,c,d]=e[i].toString().split(""),w(a,b,c,d,i),w(c,d,a,b,i)},w=(e,a,t,l,n)=>{var o=game.maxXY/10,i=.8*o,s=o/2,r=game.offset[e+""+a];let d=a*o+s,m=e*o+s;r&&(m+=r[0],d+=r[1]),g.append('<i class="node '+e+"-"+a+'" style="background-color: #'+game.colors[n]+";width: "+i+"px;height: "+i+"px;top:"+d+"px;left:"+m+'px;" data-color="'+game.colors[n]+'" data-target="'+t+"-"+l+'"data-done="0"></i>')},x=()=>{const e=new Path2D;t.lineWidth=5,e.arc(game.maxXY/2,game.maxXY/2,game.maxXY/2-30,0,2*Math.PI),t.stroke(e),game.paths.push(e)};var C=(e,a)=>{var t=game.maxXY/10,l=.5*t,n=t/2,o=game.offset[e+""+a];let i=a*t+n,s=e*t+n;o&&(s+=o[0],i+=o[1]),m.beginPath(),m.arc(s,i,l/2,0,2*Math.PI),m.fillStyle="#000",m.fill()};const k=()=>{const e=new Path2D;for(i in t.lineWidth=game.lineWidth,p){var a=p[i].split(",");0<i&&e.lineTo(a[0],a[1]),e.moveTo(a[0],a[1])}t.stroke(e),game.paths.push(e),p=[]};var X=e=>{if(game.canDraw){if(game.canDraw=!1,s.clearRect(0,0,r[0].width,r[0].height),!game.valid)return p=[];(()=>{let t=!0,e=new Path2D,l=game.lineWidth;for(i in m.strokeStyle="rgba(0,0,0,0.2)",m.fillStyle="white",m.fillRect(0,0,r[0].width,r[0].height),game.paths)0<i&&(m.lineWidth=game.lineWidth,m.stroke(game.paths[i]));for(i in p){var n=p[i].split(",");0<i&&e.lineTo(n[0],n[1]),e.moveTo(n[0],n[1])}m.stroke(e),m.lineWidth=5,m.stroke(game.paths[0]),[a,b]=game.currentLevel.split("");let o=game.levels[a][b];for(i in o)[a,b,c,d]=o[i].toString().split(""),C(a,b),C(c,d);let s;for(let a=30;a<=game.maxXY-30;a+=l){for(let e=30;e<=game.maxXY-30&&(s=m.getImageData(a,e,1,1).data,(0<s[0]||0<s[1]||0<s[2])&&(s[0]<200||s[1]<200||s[2]<200)&&(t=!1),t);e+=l);if(!t)break}return m.strokeStyle="rgba(0,0,0,0.2)",t?(k(),!0):(alert("invalid move!"),!(p=[]))})()&&(l(e).data("done",1),l("."+l(e).data("target")).data("done",1),S()),game.valid=!1}};const S=()=>{let e=!0;var a;g.find(".node").each(function(){0===l(this).data("done")&&(e=!1)}),e&&(game.levelCompleted.includes(game.currentLevel)||game.levelCompleted.push(game.currentLevel),a={levelCompleted:game.levelCompleted},localStorage.setItem("twodots",JSON.stringify(a)),alert("Well done!"),n.removeClass("d-none"),g.addClass("d-none"),o.addClass("d-none"),T(game.currentLevel.substring(0,1)))},T=a=>{var t=["BEGINNER","INTERMEDIATE","EXPERT"];if(n.html(""),1===a.length){l('<button data-level="main">Back</button>').appendTo(n);for(let e=0;e<game.levels[a].length&&(l('<button data-level="'+a+e+'">'+t[a]+" - "+(e+1)+"</button>").appendTo(n),game.levelCompleted.includes(a+""+e));e++);}else if(2===a.length)game.currentLevel=a,n.addClass("d-none"),g.removeClass("d-none"),o.removeClass("d-none"),u();else for(let e=0;e<game.levels.length;e++)l('<button data-level="'+e+'">'+t[e]+"</button>").appendTo(n)};var Y=e=>{1!==l(e).data("done")&&(h=l(e).css("left").replace("px",""),v=l(e).css("top").replace("px",""),game.currentTarget=l(e).data("target"),s.strokeStyle=t.strokeStyle="#"+l(e).data("color"),game.canDraw=!0,p.push(h+","+v))};n.on("click","button",function(e){T(l(this).data("level").toString())}),o.on("click","#go_main",function(e){n.removeClass("d-none"),g.addClass("d-none"),o.addClass("d-none"),T("main")}).on("click","#reset",function(e){u()}),r.on("mousemove",e=>{var a;game.canDraw&&(a=e.offsetX,e=e.offsetY,s.beginPath(),s.moveTo(h,v),s.lineTo(a,e),s.stroke(),h=a,v=e,p.push(h+","+v))}).on("mouseup",X),g.on("mousedown",".node",function(e){e.preventDefault(),Y(l(this))}).on("mouseenter",".node",function(e){l(this).hasClass(game.currentTarget)&&(game.valid=!0),X(l(this))}),l(window).width()<game.maxXY&&(game.maxXY=l(window).width()),g.css({width:game.maxXY+"px",height:game.maxXY+"px"}),s.canvas.height=t.canvas.height=m.canvas.height=game.maxXY,s.canvas.width=t.canvas.width=m.canvas.width=game.maxXY,s.lineCap=t.lineCap=m.lineCap="round",s.lineWidth=t.lineWidth=m.lineWidth=game.lineWidth,f(),u()}(jQuery);