let game={maxXY:500,canDraw:!1,valid:!1,lineWidth:5,oob:[0,1,2,3,6,7,8,9,10,11,18,19,20,29,30,39,60,69,70,79,80,81,88,89,90,91,92,93,96,97,98,99],offset:{"03":[20,0],"06":[20,0],30:[0,20],60:[0,20],"04":[15,0],"05":[15,0],40:[15,0],50:[15,0],93:[-20,0],96:[-20,0],39:[0,-20],69:[0,-20],49:[0,-15],59:[0,-15],94:[-15,0],95:[-15,0]},colors:["ff0000","00ff00","0000ff","ffff00"],levels:[[["2187","7166","2382"],["2187","0566","0328"],["1259","5278","6057"],["2460","0657","1274"],["1269","2687","2157"],["4036","3378","1274"],["2193","2460","4057"],["2124","2872","0547"]],[["0454","4078","2135","2876"],["2125","0647","2873","6075"],["2146","1764","2594","3378"],["1244","2833","4294","4660"],["3073","0565","3693","3459"],["0334","2659","4296","6671"],["2176","0432","4694","2359"],["1734","1369","5295","6671"]],[["3056","0537","3593","2852"],["0575","4249","2595","4047"],["4387","1256","3693","1763"],["0474","1776","5471","8226"]]],paths:[],levelCompleted:[],currentLevel:"00",currentTarget:"null"};!function(l){let n=l("#game_menu"),g=l("#game_wrapper"),e=l("#game"),o=l("#pad"),s=l("#settings"),r=e[0].getContext("2d"),m=o[0].getContext("2d"),h=l("#check")[0].getContext("2d"),p=0,v=0,f=[];const t=()=>{var e=JSON.parse(localStorage.getItem("twodots"));e&&(game.levelCompleted=e.levelCompleted||[])},u=()=>{game.paths=[],r.clearRect(0,0,o[0].width,o[0].height),m.strokeStyle=r.strokeStyle="#000",x(),g.find(".node").remove(),[a,b]=game.currentLevel.split("");let e=game.levels[a][b];for(i in e)[a,b,c,d]=e[i].toString().split(""),w(a,b,c,d,i),w(c,d,a,b,i)},w=(e,t,a,l,n)=>{var o=game.maxXY/10,i=.8*o,s=o/2,d=game.offset[e+""+t];let r=t*o+s,m=e*o+s;d&&(m+=d[0],r+=d[1],console.log(game.offset[e+""+t])),g.append('<i class="node '+e+"-"+t+'" style="background-color: #'+game.colors[n]+";width: "+i+"px;height: "+i+"px;top:"+r+"px;left:"+m+'px;" data-color="'+game.colors[n]+'" data-target="'+a+"-"+l+'"data-done="0"></i>')},x=()=>{const e=new Path2D;r.lineWidth=5,e.arc(game.maxXY/2,game.maxXY/2,game.maxXY/2-30,0,2*Math.PI),r.stroke(e),game.paths.push(e)},C=()=>{const e=new Path2D;for(i in r.lineWidth=game.lineWidth,f){var t=f[i].split(",");0<i&&e.lineTo(t[0],t[1]),e.moveTo(t[0],t[1])}r.stroke(e),game.paths.push(e),f=[]};var k=e=>{if(game.canDraw){if(game.canDraw=!1,m.clearRect(0,0,o[0].width,o[0].height),!game.valid)return f=[];(()=>{let a=!0,e=new Path2D,l=game.lineWidth;for(i in h.strokeStyle="rgba(0,0,0,0.2)",h.fillStyle="white",h.fillRect(0,0,o[0].width,o[0].height),game.paths)0<i&&(h.lineWidth=game.lineWidth,h.stroke(game.paths[i]));for(i in f){var t=f[i].split(",");0<i&&e.lineTo(t[0],t[1]),e.moveTo(t[0],t[1])}h.stroke(e),h.lineWidth=5,h.stroke(game.paths[0]);let n;for(let t=1;t<=game.maxXY;t+=l){for(let e=1;e<=game.maxXY&&(n=h.getImageData(t,e,1,1).data,(0<n[0]||0<n[1]||0<n[2])&&(n[0]<200||n[1]<200||n[2]<200)&&(a=!1),a);e+=l);if(!a)break}return h.strokeStyle="rgba(0,0,0,0.2)",a?(C(),!0):(alert("invalid move!"),!(f=[]))})()&&(l(e).data("done",1),l("."+l(e).data("target")).data("done",1),T()),game.valid=!1}};const T=()=>{let e=!0;var t;g.find(".node").each(function(){0===l(this).data("done")&&(e=!1)}),e&&(game.levelCompleted.includes(game.currentLevel)||game.levelCompleted.push(game.currentLevel),t={levelCompleted:game.levelCompleted},localStorage.setItem("twodots",JSON.stringify(t)),alert("Well done!"),n.removeClass("d-none"),g.addClass("d-none"),s.addClass("d-none"),X(game.currentLevel.substring(0,1)))},X=t=>{var a=["BEGINNER","INTERMEDIATE","EXPERT"];if(n.html(""),1===t.length){l('<button data-level="main">Back</button>').appendTo(n);for(let e=0;e<game.levels[t].length&&(l('<button data-level="'+t+e+'">'+a[t]+" - "+(e+1)+"</button>").appendTo(n),game.levelCompleted.includes(t+""+e));e++);}else if(2===t.length)game.currentLevel=t,n.addClass("d-none"),g.removeClass("d-none"),s.removeClass("d-none"),u();else for(let e=0;e<game.levels.length;e++)l('<button data-level="'+e+'">'+a[e]+"</button>").appendTo(n)};n.on("click","button",function(e){X(l(this).data("level").toString())}),s.on("click","#go_main",function(e){n.removeClass("d-none"),g.addClass("d-none"),s.addClass("d-none"),X("main")}).on("click","#reset",function(e){u()}),o.on("mousemove",e=>{var t;game.canDraw&&(t=e.offsetX,e=e.offsetY,m.beginPath(),m.moveTo(p,v),m.lineTo(t,e),m.stroke(),p=t,v=e,f.push(p+","+v))}).on("mouseup",k),g.on("mousedown",".node",function(e){e.preventDefault(),1!==l(this).data("done")&&(p=l(this).css("left").replace("px",""),v=l(this).css("top").replace("px",""),game.currentTarget=l(this).data("target"),m.strokeStyle=r.strokeStyle="#"+l(this).data("color"),game.canDraw=!0,f.push(p+","+v))}).on("mouseenter",".node",function(e){l(this).hasClass(game.currentTarget)&&(game.valid=!0),k(l(this))}),l(window).width()<game.maxXY&&(game.maxXY=l(window).width()),g.css({width:game.maxXY+"px",height:game.maxXY+"px"}),m.canvas.height=r.canvas.height=h.canvas.height=game.maxXY,m.canvas.width=r.canvas.width=h.canvas.width=game.maxXY,m.lineCap=r.lineCap=h.lineCap="round",m.lineWidth=r.lineWidth=h.lineWidth=game.lineWidth,t(),u()}(jQuery);